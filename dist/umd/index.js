!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.exampleTypescriptPackage=e():t.exampleTypescriptPackage=e()}(this,(()=>(()=>{"use strict";var t={1:t=>{function e(t,e){e=e||{},this._capacity=e.capacity,this._head=0,this._tail=0,Array.isArray(t)?this._fromArray(t):(this._capacityMask=3,this._list=new Array(4))}e.prototype.peekAt=function(t){var e=t;if(e===(0|e)){var r=this.size();if(!(e>=r||e<-r))return e<0&&(e+=r),e=this._head+e&this._capacityMask,this._list[e]}},e.prototype.get=function(t){return this.peekAt(t)},e.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},e.prototype.peekFront=function(){return this.peek()},e.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(e.prototype,"length",{get:function(){return this.size()}}),e.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.unshift=function(t){if(0===arguments.length)return this.size();var e=this._list.length;return this._head=this._head-1+e&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.shift=function(){var t=this._head;if(t!==this._tail){var e=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),e}},e.prototype.push=function(t){if(0===arguments.length)return this.size();var e=this._tail;return this._list[e]=t,this._tail=e+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.pop=function(){var t=this._tail;if(t!==this._head){var e=this._list.length;this._tail=t-1+e&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=e>>>2&&this._shrinkArray(),r}},e.prototype.removeOne=function(t){var e=t;if(e===(0|e)&&this._head!==this._tail){var r=this.size(),i=this._list.length;if(!(e>=r||e<-r)){e<0&&(e+=r),e=this._head+e&this._capacityMask;var n,o=this._list[e];if(t<r/2){for(n=t;n>0;n--)this._list[e]=this._list[e=e-1+i&this._capacityMask];this._list[e]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(n=r-1-t;n>0;n--)this._list[e]=this._list[e=e+1+i&this._capacityMask];this._list[e]=void 0,this._tail=this._tail-1+i&this._capacityMask}return o}}},e.prototype.remove=function(t,e){var r,i=t,n=e;if(i===(0|i)&&this._head!==this._tail){var o=this.size(),s=this._list.length;if(!(i>=o||i<-o||e<1)){if(i<0&&(i+=o),1===e||!e)return(r=new Array(1))[0]=this.removeOne(i),r;if(0===i&&i+e>=o)return r=this.toArray(),this.clear(),r;var a;for(i+e>o&&(e=o-i),r=new Array(e),a=0;a<e;a++)r[a]=this._list[this._head+i+a&this._capacityMask];if(i=this._head+i&this._capacityMask,t+e===o){for(this._tail=this._tail-e+s&this._capacityMask,a=e;a>0;a--)this._list[i=i+1+s&this._capacityMask]=void 0;return r}if(0===t){for(this._head=this._head+e+s&this._capacityMask,a=e-1;a>0;a--)this._list[i=i+1+s&this._capacityMask]=void 0;return r}if(i<o/2){for(this._head=this._head+t+e+s&this._capacityMask,a=t;a>0;a--)this.unshift(this._list[i=i-1+s&this._capacityMask]);for(i=this._head-1+s&this._capacityMask;n>0;)this._list[i=i-1+s&this._capacityMask]=void 0,n--;t<0&&(this._tail=i)}else{for(this._tail=i,i=i+e+s&this._capacityMask,a=o-(e+t);a>0;a--)this.push(this._list[i++]);for(i=this._tail;n>0;)this._list[i=i+1+s&this._capacityMask]=void 0,n--}return this._head<2&&this._tail>1e4&&this._tail<=s>>>2&&this._shrinkArray(),r}}},e.prototype.splice=function(t,e){var r=t;if(r===(0|r)){var i=this.size();if(r<0&&(r+=i),!(r>i)){if(arguments.length>2){var n,o,s,a=arguments.length,h=this._list.length,l=2;if(!i||r<i/2){for(o=new Array(r),n=0;n<r;n++)o[n]=this._list[this._head+n&this._capacityMask];for(0===e?(s=[],r>0&&(this._head=this._head+r+h&this._capacityMask)):(s=this.remove(r,e),this._head=this._head+r+h&this._capacityMask);a>l;)this.unshift(arguments[--a]);for(n=r;n>0;n--)this.unshift(o[n-1])}else{var c=(o=new Array(i-(r+e))).length;for(n=0;n<c;n++)o[n]=this._list[this._head+r+e+n&this._capacityMask];for(0===e?(s=[],r!=i&&(this._tail=this._head+r+h&this._capacityMask)):(s=this.remove(r,e),this._tail=this._tail-c+h&this._capacityMask);l<a;)this.push(arguments[l++]);for(n=0;n<c;n++)this.push(o[n])}return s}return this.remove(r,e)}}},e.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},e.prototype.isEmpty=function(){return this._head===this._tail},e.prototype.toArray=function(){return this._copyArray(!1)},e.prototype._fromArray=function(t){var e=t.length,r=this._nextPowerOf2(e);this._list=new Array(r),this._capacityMask=r-1,this._tail=e;for(var i=0;i<e;i++)this._list[i]=t[i]},e.prototype._copyArray=function(t,e){var r=this._list,i=r.length,n=this.length;if((e|=n)==n&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o,s=new Array(e),a=0;if(t||this._head>this._tail){for(o=this._head;o<i;o++)s[a++]=r[o];for(o=0;o<this._tail;o++)s[a++]=r[o]}else for(o=this._head;o<this._tail;o++)s[a++]=r[o];return s},e.prototype._growArray=function(){if(0!=this._head){var t=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=t}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},e.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.prototype._nextPowerOf2=function(t){var e=1<<Math.log(t)/Math.log(2)+1;return Math.max(e,4)},t.exports=e},977:t=>{function e(t,e,r,i,n,o){this._color=t,this.key=e,this.value=r,this.left=i,this.right=n,this._count=o}function r(t){return new e(t._color,t.key,t.value,t.left,t.right,t._count)}function i(t,r){return new e(t,r.key,r.value,r.left,r.right,r._count)}function n(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function o(t,e){this._compare=t,this.root=e}t.exports=function(t){return new o(t||_,null)};var s=o.prototype;function a(t,e){var r;return e.left&&(r=a(t,e.left))?r:(r=t(e.key,e.value))||(e.right?a(t,e.right):void 0)}function h(t,e,r,i){if(e(t,i.key)<=0){var n;if(i.left&&(n=h(t,e,r,i.left)))return n;if(n=r(i.key,i.value))return n}if(i.right)return h(t,e,r,i.right)}function l(t,e,r,i,n){var o,s=r(t,n.key),a=r(e,n.key);if(s<=0){if(n.left&&(o=l(t,e,r,i,n.left)))return o;if(a>0&&(o=i(n.key,n.value)))return o}if(a>0&&n.right)return l(t,e,r,i,n.right)}function c(t,e){this.tree=t,this._stack=e}Object.defineProperty(s,"keys",{get:function(){var t=[];return this.forEach((function(e,r){t.push(e)})),t}}),Object.defineProperty(s,"values",{get:function(){var t=[];return this.forEach((function(e,r){t.push(r)})),t}}),Object.defineProperty(s,"length",{get:function(){return this.root?this.root._count:0}}),s.insert=function(t,r){for(var s=this._compare,a=this.root,h=[],l=[];a;){var c=s(t,a.key);h.push(a),l.push(c),a=c<=0?a.left:a.right}h.push(new e(0,t,r,null,null,1));for(var u=h.length-2;u>=0;--u)a=h[u],l[u]<=0?h[u]=new e(a._color,a.key,a.value,h[u+1],a.right,a._count+1):h[u]=new e(a._color,a.key,a.value,a.left,h[u+1],a._count+1);for(u=h.length-1;u>1;--u){var f=h[u-1];if(a=h[u],1===f._color||1===a._color)break;var _=h[u-2];if(_.left===f)if(f.left===a){if(!(p=_.right)||0!==p._color){_._color=0,_.left=f.right,f._color=1,f.right=_,h[u-2]=f,h[u-1]=a,n(_),n(f),u>=3&&((d=h[u-3]).left===_?d.left=f:d.right=f);break}f._color=1,_.right=i(1,p),_._color=0,u-=1}else{if(!(p=_.right)||0!==p._color){f.right=a.left,_._color=0,_.left=a.right,a._color=1,a.left=f,a.right=_,h[u-2]=a,h[u-1]=f,n(_),n(f),n(a),u>=3&&((d=h[u-3]).left===_?d.left=a:d.right=a);break}f._color=1,_.right=i(1,p),_._color=0,u-=1}else if(f.right===a){if(!(p=_.left)||0!==p._color){_._color=0,_.right=f.left,f._color=1,f.left=_,h[u-2]=f,h[u-1]=a,n(_),n(f),u>=3&&((d=h[u-3]).right===_?d.right=f:d.left=f);break}f._color=1,_.left=i(1,p),_._color=0,u-=1}else{var p;if(!(p=_.left)||0!==p._color){var d;f.left=a.right,_._color=0,_.right=a.left,a._color=1,a.right=f,a.left=_,h[u-2]=a,h[u-1]=f,n(_),n(f),n(a),u>=3&&((d=h[u-3]).right===_?d.right=a:d.left=a);break}f._color=1,_.left=i(1,p),_._color=0,u-=1}}return h[0]._color=1,new o(s,h[0])},s.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return a(t,this.root);case 2:return h(e,this._compare,t,this.root);case 3:if(this._compare(e,r)>=0)return;return l(e,r,this._compare,t,this.root)}},Object.defineProperty(s,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new c(this,t)}}),Object.defineProperty(s,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new c(this,t)}}),s.at=function(t){if(t<0)return new c(this,[]);for(var e=this.root,r=[];;){if(r.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new c(this,r);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new c(this,[])},s.ge=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o<=0&&(n=i.length),r=o<=0?r.left:r.right}return i.length=n,new c(this,i)},s.gt=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o<0&&(n=i.length),r=o<0?r.left:r.right}return i.length=n,new c(this,i)},s.lt=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o>0&&(n=i.length),r=o<=0?r.left:r.right}return i.length=n,new c(this,i)},s.le=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o>=0&&(n=i.length),r=o<0?r.left:r.right}return i.length=n,new c(this,i)},s.find=function(t){for(var e=this._compare,r=this.root,i=[];r;){var n=e(t,r.key);if(i.push(r),0===n)return new c(this,i);r=n<=0?r.left:r.right}return new c(this,[])},s.remove=function(t){var e=this.find(t);return e?e.remove():this},s.get=function(t){for(var e=this._compare,r=this.root;r;){var i=e(t,r.key);if(0===i)return r.value;r=i<=0?r.left:r.right}};var u=c.prototype;function f(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function _(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(u,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(u,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),u.clone=function(){return new c(this.tree,this._stack.slice())},u.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var s=new Array(t.length),a=t[t.length-1];s[s.length-1]=new e(a._color,a.key,a.value,a.left,a.right,a._count);for(var h=t.length-2;h>=0;--h)(a=t[h]).left===t[h+1]?s[h]=new e(a._color,a.key,a.value,s[h+1],a.right,a._count):s[h]=new e(a._color,a.key,a.value,a.left,s[h+1],a._count);if((a=s[s.length-1]).left&&a.right){var l=s.length;for(a=a.left;a.right;)s.push(a),a=a.right;var c=s[l-1];for(s.push(new e(a._color,c.key,c.value,a.left,a.right,a._count)),s[l-1].key=a.key,s[l-1].value=a.value,h=s.length-2;h>=l;--h)a=s[h],s[h]=new e(a._color,a.key,a.value,a.left,s[h+1],a._count);s[l-1].left=s[l]}if(0===(a=s[s.length-1])._color){var u=s[s.length-2];for(u.left===a?u.left=null:u.right===a&&(u.right=null),s.pop(),h=0;h<s.length;++h)s[h]._count--;return new o(this.tree._compare,s[0])}if(a.left||a.right){for(a.left?f(a,a.left):a.right&&f(a,a.right),a._color=1,h=0;h<s.length-1;++h)s[h]._count--;return new o(this.tree._compare,s[0])}if(1===s.length)return new o(this.tree._compare,null);for(h=0;h<s.length;++h)s[h]._count--;var _=s[s.length-2];return function(t){for(var e,o,s,a,h=t.length-1;h>=0;--h){if(e=t[h],0===h)return void(e._color=1);if((o=t[h-1]).left===e){if((s=o.right).right&&0===s.right._color)return a=(s=o.right=r(s)).right=r(s.right),o.right=s.left,s.left=o,s.right=a,s._color=o._color,e._color=1,o._color=1,a._color=1,n(o),n(s),h>1&&((l=t[h-2]).left===o?l.left=s:l.right=s),void(t[h-1]=s);if(s.left&&0===s.left._color)return a=(s=o.right=r(s)).left=r(s.left),o.right=a.left,s.left=a.right,a.left=o,a.right=s,a._color=o._color,o._color=1,s._color=1,e._color=1,n(o),n(s),n(a),h>1&&((l=t[h-2]).left===o?l.left=a:l.right=a),void(t[h-1]=a);if(1===s._color){if(0===o._color)return o._color=1,void(o.right=i(0,s));o.right=i(0,s);continue}s=r(s),o.right=s.left,s.left=o,s._color=o._color,o._color=0,n(o),n(s),h>1&&((l=t[h-2]).left===o?l.left=s:l.right=s),t[h-1]=s,t[h]=o,h+1<t.length?t[h+1]=e:t.push(e),h+=2}else{if((s=o.left).left&&0===s.left._color)return a=(s=o.left=r(s)).left=r(s.left),o.left=s.right,s.right=o,s.left=a,s._color=o._color,e._color=1,o._color=1,a._color=1,n(o),n(s),h>1&&((l=t[h-2]).right===o?l.right=s:l.left=s),void(t[h-1]=s);if(s.right&&0===s.right._color)return a=(s=o.left=r(s)).right=r(s.right),o.left=a.right,s.right=a.left,a.right=o,a.left=s,a._color=o._color,o._color=1,s._color=1,e._color=1,n(o),n(s),n(a),h>1&&((l=t[h-2]).right===o?l.right=a:l.left=a),void(t[h-1]=a);if(1===s._color){if(0===o._color)return o._color=1,void(o.left=i(0,s));o.left=i(0,s);continue}var l;s=r(s),o.left=s.right,s.right=o,s._color=o._color,o._color=0,n(o),n(s),h>1&&((l=t[h-2]).right===o?l.right=s:l.left=s),t[h-1]=s,t[h]=o,h+1<t.length?t[h+1]=e:t.push(e),h+=2}}}(s),_.left===a?_.left=null:_.right=null,new o(this.tree._compare,s[0])},Object.defineProperty(u,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(u,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(u,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var r=this.tree.root;return r?r._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var i=e.length-2;i>=0;--i)e[i+1]===e[i].right&&(++t,e[i].left&&(t+=e[i].left._count));return t},enumerable:!0}),u.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(u,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),u.update=function(t){var r=this._stack;if(0===r.length)throw new Error("Can't update empty node!");var i=new Array(r.length),n=r[r.length-1];i[i.length-1]=new e(n._color,n.key,t,n.left,n.right,n._count);for(var s=r.length-2;s>=0;--s)(n=r[s]).left===r[s+1]?i[s]=new e(n._color,n.key,n.value,i[s+1],n.right,n._count):i[s]=new e(n._color,n.key,n.value,n.left,i[s+1],n._count);return new o(this.tree._compare,i[0])},u.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(u,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})},514:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OrderBook=void 0;var i=r(764),n=r(497),o=Object.values(i.TimeInForce);e.OrderBook=function(){var t=this;this.orders={},this.createOrder=function(e,r,n,o,s,a){switch(void 0===a&&(a=i.TimeInForce.GTC),e){case i.OrderType.MARKET:return t.market(r,n);case i.OrderType.LIMIT:return t.limit(r,s,n,o,a);default:return{done:[],partial:null,partialQuantityProcessed:0,quantityLeft:n,err:new Error("orderbook: supported order type are 'limit' and 'market'")}}},this.market=function(e,r){var n,o,s={done:[],partial:null,partialQuantityProcessed:0,quantityLeft:r,err:null};if(e!==i.Side.SELL&&e!==i.Side.BUY)return s.err=new Error("orderbook: given neither 'bid' nor 'ask'"),s;if(!r||"number"!=typeof r||r<=0)return s.err=new Error("orderbook: insufficient quantity to calculate price"),s;for(e===i.Side.BUY?(n=t.asks.minPriceQueue,o=t.asks):(n=t.bids.maxPriceQueue,o=t.bids);r>0&&o.len()>0;){var a=n(),h=t.processQueue(a,r),l=h.done,c=h.partial,u=h.partialQuantityProcessed,f=h.quantityLeft;s.done=s.done.concat(l),s.partial=c,s.partialQuantityProcessed=u,r=f||0}return s.quantityLeft=r,s},this.limit=function(e,r,n,s,a){void 0===a&&(a=i.TimeInForce.GTC);var h={done:[],partial:null,partialQuantityProcessed:0,quantityLeft:n,err:null};if(e!==i.Side.SELL&&e!==i.Side.BUY)return h.err=new Error("orderbook: given neither 'bid' nor 'ask'"),h;if(t.orders[r])return h.err=new Error("orderbook: order already exists"),h;if(!n||"number"!=typeof n||n<=0)return h.err=new Error("orderbook: invalid order quantity"),h;if(!s||"number"!=typeof s||s<=0)return h.err=new Error("orderbook: invalid order price"),h;if(!o.includes(a))return h.err=new Error("orderbook: supported time in force are 'GTC', 'IOC' and 'FOK'"),h;var l,c,u,f,_=n;if(e===i.Side.BUY?(c=t.bids,l=t.asks,u=t.greaterThanOrEqual,f=t.asks.minPriceQueue):(c=t.asks,l=t.bids,u=t.lowerThanOrEqual,f=t.bids.maxPriceQueue),a===i.TimeInForce.FOK&&!t.canFillOrder(l,e,n,s))return h.err=new Error("orderbook: limit FOK order not fillable"),h;for(var p=f();_>0&&l.len()>0&&p&&u(s,p.price());){var d=t.processQueue(p,_),g=d.done,v=d.partial,y=d.partialQuantityProcessed,k=d.quantityLeft;h.done=h.done.concat(g),h.partial=v,h.partialQuantityProcessed=y,_=k||0,h.quantityLeft=_,p=f()}if(_>0){var m=new i.Order(r,e,_,s,Date.now(),!0);h.done.length>0&&(h.partialQuantityProcessed=n-_,h.partial=m),t.orders[r]=c.append(m)}else{var b=0,w=0;h.done.forEach((function(t){b+=t.size,w+=t.price*t.size})),h.partialQuantityProcessed&&h.partial&&h.partialQuantityProcessed>0&&(b+=h.partialQuantityProcessed,w+=h.partial.price*h.partialQuantityProcessed),h.done.push(new i.Order(r,e,n,w/b,Date.now()))}return a===i.TimeInForce.IOC&&h.quantityLeft>0&&t.cancel(r),h},this.modify=function(e,r){var n=t.orders[e];if(n){var o=r.side;if(o===i.Side.BUY)return t.bids.update(n,r);if(o===i.Side.SELL)return t.asks.update(n,r);throw new Error("orderbook: given neither 'bid' nor 'ask'")}},this.cancel=function(e){var r=t.orders[e];if(r)return delete t.orders[e],r.side===i.Side.BUY?t.bids.remove(r):t.asks.remove(r)},this.order=function(e){return t.orders[e]},this.depth=function(){var e=[],r=[];return t.asks.priceTree().forEach((function(t,r){e.push([t,r.volume()])})),t.bids.priceTree().forEach((function(t,e){r.push([t,e.volume()])})),[e,r]},this.toString=function(){return t.asks.toString()+"\r\n------------------------------------"+t.bids.toString()},this.calculateMarketPrice=function(e,r){var n,o,s=0,a=null;for(e===i.Side.BUY?(n=t.asks.minPriceQueue(),o=t.asks.greaterThan):(n=t.bids.maxPriceQueue(),o=t.bids.lowerThan);r>0&&n;){var h=n.volume(),l=n.price();t.greaterThanOrEqual(r,h)?(s+=l*h,r-=h,n=o(l)):(s+=l*r,r=0)}return r>0&&(a=new Error("orderbook: insufficient quantity to calculate price")),{price:s,err:a}},this.greaterThanOrEqual=function(t,e){return t>=e},this.lowerThanOrEqual=function(t,e){return t<=e},this.processQueue=function(e,r){var n={done:[],partial:null,partialQuantityProcessed:0,quantityLeft:r,err:null};if(n.quantityLeft)for(;e.len()>0&&n.quantityLeft>0;){var o=e.head();if(o)if(n.quantityLeft<o.size)n.partial=new i.Order(o.id,o.side,o.size-n.quantityLeft,o.price,o.time,!0),t.orders[o.id]=n.partial,n.partialQuantityProcessed=n.quantityLeft,e.update(o,n.partial),n.quantityLeft=0;else{n.quantityLeft=n.quantityLeft-o.size;var s=t.cancel(o.id);s&&n.done.push(s)}}return n},this.canFillOrder=function(e,r,n,o){return r===i.Side.BUY?t.buyOrderCanBeFilled(e,n,o):t.sellOrderCanBeFilled(e,n,o)},this.buyOrderCanBeFilled=function(t,e,r){if(t.volume()<e)return!1;var i=0;return t.priceTree().forEach((function(t,n){if(!(r>=n.price()&&i<e))return!0;i+=n.volume()})),i>=e},this.sellOrderCanBeFilled=function(t,e,r){if(t.volume()<e)return!1;var i=0;return t.priceTree().forEach((function(t,n){if(!(r<=n.price()&&i<e))return!0;i+=n.volume()})),i>=e},this.bids=new n.OrderSide(i.Side.BUY),this.asks=new n.OrderSide(i.Side.SELL)}},764:(t,e)=>{var r,i,n;Object.defineProperty(e,"__esModule",{value:!0}),e.Order=e.TimeInForce=e.OrderType=e.Side=void 0,function(t){t.BUY="buy",t.SELL="sell"}(r||(e.Side=r={})),function(t){t.LIMIT="limit",t.MARKET="market"}(i||(e.OrderType=i={})),function(t){t.GTC="GTC",t.IOC="IOC",t.FOK="FOK"}(n||(e.TimeInForce=n={}));var o=function(){function t(t,e,r,i,n,o){var s=this;this.toString=function(){return"".concat(s._id,":\n    side: ").concat(s._side,"\n    size: ").concat(s._side,"\n    price: ").concat(s._price,"\n    time: ").concat(s._time,"\n    isMaker: ").concat(s.isMaker)},this.toJSON=function(){return JSON.stringify({id:s._id,side:s._side,size:s._size,price:s._price,time:s._time,isMaker:s.isMaker})},this.toObject=function(){return{id:s._id,side:s._side,size:s._size,price:s._price,time:s._time,isMaker:s.isMaker}},this._id=t,this._side=e,this._price=i,this._size=r,this._time=n||Date.now(),this._isMaker=o||!1}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"side",{get:function(){return this._side},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"price",{get:function(){return this._price},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(t){this._time=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMaker",{get:function(){return this._isMaker},enumerable:!1,configurable:!0}),t}();e.Order=o},587:function(t,e,r){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Queue=void 0;var n=i(r(1));e.Queue=function(t){var e=this;this._ordersMap={},this.len=function(){return e._orders.length},this.toArray=function(){return e._orders.toArray()},this.price=function(){return e._price},this.volume=function(){return e._volume},this.head=function(){return e._orders.peekFront()},this.tail=function(){return e._orders.peekBack()},this.append=function(t){return e._volume+=t.size,e._orders.push(t),e._ordersMap[t.id]=e._orders.length-1,t},this.update=function(t,r){e._volume-=t.size,e._volume+=r.size,e._orders.shift(),delete e._ordersMap[t.id],e._orders.unshift(r),e._ordersMap[r.id]=0},this.remove=function(t){e._volume-=t.size;var r=e._ordersMap[t.id];for(var i in e._orders.removeOne(r),delete e._ordersMap[t.id],e._ordersMap)Object.prototype.hasOwnProperty.call(e._ordersMap,i)&&e._ordersMap[i]>r&&(e._ordersMap[i]-=1)},this.updateOrderSize=function(t,r){e._volume+=r-t.size,t.size=r,t.time=Date.now()},this._price=t,this._volume=0,this._orders=new n.default}},497:function(t,e,r){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.OrderSide=void 0;var n=i(r(977)),o=r(764),s=r(587);e.OrderSide=function(t){var e=this;this._prices={},this._volume=0,this._total=0,this._numOrders=0,this._depthSide=0,this._side=o.Side.SELL,this.len=function(){return e._numOrders},this.depth=function(){return e._depthSide},this.volume=function(){return e._volume},this.total=function(){return e._total},this.priceTree=function(){return e._priceTree},this.append=function(t){var r=t.price,i=r.toString();if(!e._prices[i]){var n=new s.Queue(r);e._prices[i]=n,e._priceTree=e._priceTree.insert(r,n),e._depthSide+=1}return e._numOrders+=1,e._volume+=t.size,e._total+=t.size*t.price,e._prices[i].append(t)},this.remove=function(t){var r=t.price,i=r.toString();if(!e._prices[i])throw new Error("orderbook: invalid order price level");return e._prices[i].remove(t),0===e._prices[i].len()&&(delete e._prices[i],e._priceTree=e._priceTree.remove(r),e._depthSide-=1),e._numOrders-=1,e._volume-=t.size,e._total-=t.size*t.price,t},this.update=function(t,r){if(void 0!==r.price&&r.price!==t.price){e.remove(t);var i=new o.Order(t.id,t.side,r.size||t.size,r.price,Date.now(),t.isMaker);return e.append(i),i}if(void 0!==r.size&&r.size!==t.size){var n=t.price.toString();return e._volume+=r.size-t.size,e._total+=r.size*r.price-t.size*t.price,e._prices[n].updateOrderSize(t,r.size),t}},this.maxPriceQueue=function(){if(e._depthSide>0)return(e._side===o.Side.SELL?e._priceTree.end:e._priceTree.begin).value},this.minPriceQueue=function(){if(e._depthSide>0)return(e._side===o.Side.SELL?e._priceTree.begin:e._priceTree.end).value},this.lowerThan=function(t){return(e._side===o.Side.SELL?e._priceTree.lt(t):e._priceTree.gt(t)).value},this.greaterThan=function(t){return(e._side===o.Side.SELL?e._priceTree.gt(t):e._priceTree.lt(t)).value},this.orders=function(){var t=[];for(var r in e._prices)if(Object.prototype.hasOwnProperty.call(e._prices,r)){var i=e._prices[r].toArray();t=t.concat(i)}return t},this.toString=function(){for(var t="",r=e.maxPriceQueue();r;)t+="\n".concat(r.price()," -> ").concat(r.volume()),r=e.lowerThan(r.price());return t};var r=t===o.Side.SELL?function(t,e){return t-e}:function(t,e){return e-t};this._priceTree=(0,n.default)(r),this._side=t}}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,r),o.exports}var i={};return(()=>{var t=i;Object.defineProperty(t,"__esModule",{value:!0}),t.OrderBook=void 0;var e=r(514);Object.defineProperty(t,"OrderBook",{enumerable:!0,get:function(){return e.OrderBook}})})(),i})()));